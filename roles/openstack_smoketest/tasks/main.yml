---
- name: OpenStack servers
  os_server_facts:
    cloud: ospcloud
    server: frontend
  register: facts_result

- name: check front end for string
  uri:
    url:  "http://{{item.public_v4}}"
    return_content: yes
  #retries: 5
  #delay: 10
  register: uri_result
  #until: uri_result.status is '200'
  loop: "{{ facts_result.ansible_facts.openstack_servers }}"
- debug:
    msg: Status code is - "{{item.status}}"
  loop: "{{ uri_result.results }}"

- name: If status code is not 200, fail.
  fail:
  when: item.status != '200'
  loop: "{{ uri_result.results }}"

  
